import Navbar from "../components/navbar";
import axios from "axios";
import { useState, useEffect } from "react";
import { Triangle } from "react-loader-spinner";

export default function Dashboard() {
  const [exploitList, setExploitList] = useState([]);
  const [userData, setUserData] = useState([]);

  useEffect(() => {
    async function fetchData() {
      try {
        const userResponse = await axios.get(
          "http://localhost:5000/api/user/current",
          {
            withCredentials: true,
          }
        );
        setUserData(userResponse.data);

        const exploitResponse = await axios.get(
          "http://localhost:5000/api/exploit/",
          {
            withCredentials: true,
          }
        );
        setExploitList(exploitResponse.data.exploits);
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    fetchData();
  }, []); // Empty dependency array for componentDidMount effect

  console.log(exploitList);
  console.log(userData.user.username);

  if (!userData.length) {
    return (
      <>
        <div class="h-[40rem] flex justify-center items-center">
          <Triangle
            height="80"
            width="80"
            color="#000000"
            ariaLabel="triangle-loading"
            wrapperStyle={{}}
            wrapperClassName=""
            visible={true}
          />
        </div>
      </>
    );
  } else {
    return (
      <div class="rounded-xl">
        <Navbar />
        <div className="p-5">
          <h2 className="text-3xl font-semibold mb-6">
            Welcome, {userData.username}!
          </h2>

          <h1 class="text-3xl font-medium mb-4">Exploit Dashboard</h1>
          <ul>
            <a href="/exploit">
              {exploitList &&
                exploitList.exploits.map((exploit) => (
                  <li class="flex justify-between gap-x-6 p-5 bg-slate-200 rounded-xl">
                    <div class="flex min-w-0 gap-x-4 ">
                      <div class="min-w-0 flex-auto">
                        <p class="text-lg font-semibold leading-6 text-gray-900">
                          {exploit.exploitName}
                        </p>
                        <p class="mt-1 truncate text-md leading-5 text-gray-500">
                          {exploit.userId}
                        </p>
                      </div>
                    </div>
                    <div class="hidden shrink-0 sm:flex sm:flex-col sm:items-end">
                      <p class="text-md leading-6 text-gray-900">
                        Type : {exploit.exploitType}
                      </p>
                      <p class="mt-1 text-md leading-5 text-gray-500">
                        Platform : {exploit.platform}
                      </p>
                    </div>
                  </li>
                ))}
            </a>
          </ul>
        </div>
      </div>
    );
  }
}
